<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MTB CAT1 Peripheral driver library: ADCMic       (Delta-Sigma ADC with PDM microphone support)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="IFXCYP_one-line.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MTB CAT1 Peripheral driver library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__group__adcmic.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">API Reference</a>  </div>
  <div class="headertitle">
<div class="title">ADCMic (Delta-Sigma ADC with PDM microphone support)</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">General Description</h2>
<p>ADCMic driver is used to process analog and digital microphone signal and DC signal with the mxs40adcmic IP. </p>
<p>This IP interfaces with Delta-Sigma modulator part of the s40adcmic and implements CIC, decimation (FIR) and biquad filters. The ADC result is read by the CPU or the DMA from the FIFO of mxs40adcmic (and from CIC register for DC measurement). Instead of taking modulator data from s40adcmic, mxs40adcmic can also be configured to take PDM input directly from an external digital microphone.</p>
<div class="image">
<img src="ADCMicBlockDiagram.png" alt="ADCMicBlockDiagram.png"/>
</div>
<p>Consult the datasheet of your device for details of the clock system.</p>
<p>The high level features of the subsystem are:</p><ul>
<li>Analog (MIC) and digital (PDM) microphones support.</li>
<li>Sample rate 8/16 ksps for audio (microphones) and 480 ksps for DC measurement.</li>
<li>Configurable biquad filter for custom audio equalization.</li>
<li>Selectable DC measurement range.</li>
<li>interrupt &amp; trigger generation.</li>
<li>built-in FIFO buffer (for audio only).</li>
</ul>
<h1><a class="anchor" id="group_adcmic_usage"></a>
Usage</h1>
<p>The high level steps to use this driver are:</p>
<ol type="1">
<li><a class="el" href="group__group__adcmic.html#group_adcmic_initialization">Initialization and Enabling</a></li>
<li><a class="el" href="group__group__adcmic.html#group_adcmic_clock">Clocks</a></li>
<li><a class="el" href="group__group__adcmic.html#group_adcmic_trigger">Triggering</a></li>
<li><a class="el" href="group__group__adcmic.html#group_adcmic_timer">Timer</a></li>
<li><a class="el" href="group__group__adcmic.html#group_adcmic_interrupt">Handling Interrupts</a></li>
<li><a class="el" href="group__group__adcmic.html#group_adcmic_dc_result">Retrieve DC Measurement Results</a></li>
<li><a class="el" href="group__group__adcmic.html#group_adcmic_fifo">FIFO Usage</a></li>
</ol>
<h1><a class="anchor" id="group_adcmic_initialization"></a>
Initialization and Enabling</h1>
<p>To configure the ADCMic subsystem call <a class="el" href="group__group__adcmic__functions__basic.html#ga2d6efe6fc6a1d0f8f2164352fbe8a39d">Cy_ADCMic_Init</a>. Pass in a pointer to the <a class="el" href="struct_m_x_s40_a_d_c_m_i_c___type.html">MXS40ADCMIC_Type</a> structure for the base hardware register address and pass in the configuration structure <a class="el" href="structcy__stc__adcmic__config__t.html">cy_stc_adcmic_config_t</a>.</p>
<p>After initialization, call <a class="el" href="group__group__adcmic__functions__basic.html#ga79da38d2baa05887ea3247d530b37b7f">Cy_ADCMic_Enable</a> to enable the block.</p>
<h2><a class="anchor" id="group_adcmic_mic"></a>
Analog Microphone (MIC) Mode</h2>
<div class="fragment"><div class="line"><a class="code" href="structcy__stc__adcmic__audio__analog__path__config__t.html">cy_stc_adcmic_audio_analog_path_config_t</a> ADCMicAnaCfg =</div><div class="line">{</div><div class="line">    .<a class="code" href="structcy__stc__adcmic__audio__analog__path__config__t.html#a6ecde6a6ba6b2fb04ebadac70d427d57">micBias</a> = <a class="code" href="group__group__adcmic__enums.html#gga5f12d4f2b8ec927e1f37a308911185b8a9b39de329660a3b988f612084224367e">CY_ADCMIC_BIAS_1_12_REF</a>,</div><div class="line">    .micBiasLz = <span class="keyword">false</span>,</div><div class="line">    .micPd = <span class="keyword">false</span>,</div><div class="line">    .micClamp = <span class="keyword">true</span>,</div><div class="line">    .pgaGain = <a class="code" href="group__group__adcmic__enums.html#ggadeb06cc1ffc25c6cceffeb34f0fa36d8aa69662c9fed6e94346d2ae08b7019e6d">CY_ADCMIC_PGA_GAIN_6</a>, <span class="comment">/* 2X */</span></div><div class="line">    .pgaInCm = <a class="code" href="group__group__adcmic__enums.html#ggaa52a286a28db88c27c12895f59e47540ad220fad8944d658095d510f96c6c7c67">CY_ADCMIC_INCM_0_4</a>,</div><div class="line">    .pgaOutCm = <a class="code" href="group__group__adcmic__enums.html#gga3cff7b2219fa028c9b695681214483cca610c55ab84c5ec06bd933b56db190232">CY_ADCMIC_OUTCM_0_6</a></div><div class="line">};</div><div class="line"></div><div class="line"><a class="code" href="structcy__stc__adcmic__fifo__config__t.html">cy_stc_adcmic_fifo_config_t</a> ADCMicFifoCfg =</div><div class="line">{</div><div class="line">    .<a class="code" href="structcy__stc__adcmic__fifo__config__t.html#a35946231464b1f961459522e7dee707c">full</a> = 60U,</div><div class="line">    .empty = 4U</div><div class="line">};</div><div class="line"></div><div class="line"><a class="code" href="structcy__stc__adcmic__config__t.html">cy_stc_adcmic_config_t</a> ADCMicCfg =</div><div class="line">{</div><div class="line">    .<a class="code" href="structcy__stc__adcmic__config__t.html#a4d3c269ce9081eb9925acd71a687114e">clockDiv</a> = 2U,</div><div class="line">    .source = <a class="code" href="group__group__adcmic__enums.html#ggabdc8870e3b406f6d7aa66e5a92affb62aa0919e8b8af8bc814cd0c65eae6fd34d">CY_ADCMIC_MIC</a>,</div><div class="line">    .sampleRate = <a class="code" href="group__group__adcmic__enums.html#gga60be2d6103fee3f7a1dbb0f7732ecb16a038e2dac3c3ad85e5310f28e5eed3b07">CY_ADCMIC_8KSPS</a>,</div><div class="line">    .anaConfig = &amp;ADCMicAnaCfg,</div><div class="line">    .digConfig = NULL,</div><div class="line">    .dcConfig = NULL,</div><div class="line">    .biQuadConfig = NULL,</div><div class="line">    .fifoConfig = &amp;ADCMicFifoCfg,</div><div class="line">    .tmrTrgConfig = NULL</div><div class="line">};</div></div><!-- fragment --><div class="fragment"><div class="line">    <span class="comment">/* Scenario: Initialize ADCMic for the analog microphone operation: */</span></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__group__adcmic__enums.html#ggaf46b38a86a6fbdfee98d9b37ae44a154a5372a55427aca75e12013c2bb7844157">CY_ADCMIC_SUCCESS</a> != <a class="code" href="group__group__adcmic__functions__basic.html#ga2d6efe6fc6a1d0f8f2164352fbe8a39d">Cy_ADCMic_Init</a>(MXS40ADCMIC0, &amp;ADCMicCfg))</div><div class="line">    {</div><div class="line">        <span class="comment">/* Something went wrong, insert error handling here */</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__group__adcmic__enums.html#ggaf46b38a86a6fbdfee98d9b37ae44a154a5372a55427aca75e12013c2bb7844157">CY_ADCMIC_SUCCESS</a> != <a class="code" href="group__group__adcmic__functions__basic.html#ga76a424f92c974d8373b1c9dd75ee2e77">Cy_ADCMic_SetSampleRate</a>(MXS40ADCMIC0, <a class="code" href="group__group__adcmic__enums.html#gga60be2d6103fee3f7a1dbb0f7732ecb16a66ba39acdbc0f0925fb6c67e700448c3">CY_ADCMIC_16KSPS</a>))</div><div class="line">    {</div><div class="line">        <span class="comment">/* Something went wrong, insert error handling here */</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="group__group__adcmic__functions__basic.html#ga79da38d2baa05887ea3247d530b37b7f">Cy_ADCMic_Enable</a>(MXS40ADCMIC0); <span class="comment">/* Enable the block */</span></div><div class="line">    <a class="code" href="group__group__adcmic__functions__basic.html#gaa5d3e860c0703f4daa932ed6d3e2b416">Cy_ADCMic_StartConvert</a>(MXS40ADCMIC0); <span class="comment">/* Start the conversion */</span></div></div><!-- fragment --><p> Usually the MIC mode is used with FIFO, see <a class="el" href="group__group__adcmic.html#group_adcmic_fifo">FIFO Usage</a></p>
<h2><a class="anchor" id="group_adcmic_pdm"></a>
Digital Microphone (PDM) Mode</h2>
<div class="fragment"><div class="line"><a class="code" href="structcy__stc__adcmic__audio__digital__path__config__t.html">cy_stc_adcmic_audio_digital_path_config_t</a> ADCMicDigCfg =</div><div class="line">{</div><div class="line">    .<a class="code" href="structcy__stc__adcmic__audio__digital__path__config__t.html#ac41b425c3e177c3fc3c522792f31e567">clockDiv</a> = 10U,</div><div class="line">    .clockInv = <span class="keyword">false</span>,</div><div class="line">    .latchDelay = 1U</div><div class="line">};</div><div class="line"></div><div class="line"><a class="code" href="structcy__stc__adcmic__fifo__config__t.html">cy_stc_adcmic_fifo_config_t</a> ADCMicPdmFifoCfg =</div><div class="line">{</div><div class="line">    .<a class="code" href="structcy__stc__adcmic__fifo__config__t.html#a35946231464b1f961459522e7dee707c">full</a> = 60U,</div><div class="line">    .empty = 4U</div><div class="line">};</div><div class="line"></div><div class="line"><a class="code" href="structcy__stc__adcmic__config__t.html">cy_stc_adcmic_config_t</a> ADCMicPdmCfg =</div><div class="line">{</div><div class="line">    .<a class="code" href="structcy__stc__adcmic__config__t.html#a4d3c269ce9081eb9925acd71a687114e">clockDiv</a> = 2U,</div><div class="line">    .source = <a class="code" href="group__group__adcmic__enums.html#ggabdc8870e3b406f6d7aa66e5a92affb62af219be692b133cbf3be83c90009b8bd8">CY_ADCMIC_PDM</a>,</div><div class="line">    .sampleRate = <a class="code" href="group__group__adcmic__enums.html#gga60be2d6103fee3f7a1dbb0f7732ecb16a038e2dac3c3ad85e5310f28e5eed3b07">CY_ADCMIC_8KSPS</a>,</div><div class="line">    .anaConfig = NULL,</div><div class="line">    .digConfig = &amp;ADCMicDigCfg,</div><div class="line">    .dcConfig = NULL,</div><div class="line">    .biQuadConfig = NULL,</div><div class="line">    .fifoConfig = &amp;ADCMicFifoCfg,</div><div class="line">    .tmrTrgConfig = NULL</div><div class="line">};</div></div><!-- fragment --><div class="fragment"><div class="line">    <span class="comment">/* Scenario: Initialize ADCMic for the digital microphone operation: */</span></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__group__adcmic__enums.html#ggaf46b38a86a6fbdfee98d9b37ae44a154a5372a55427aca75e12013c2bb7844157">CY_ADCMIC_SUCCESS</a> != <a class="code" href="group__group__adcmic__functions__basic.html#ga2d6efe6fc6a1d0f8f2164352fbe8a39d">Cy_ADCMic_Init</a>(MXS40ADCMIC0, &amp;ADCMicPdmCfg))</div><div class="line">    {</div><div class="line">        <span class="comment">/* Something went wrong, insert error handling here */</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="group__group__adcmic__functions__basic.html#ga79da38d2baa05887ea3247d530b37b7f">Cy_ADCMic_Enable</a>(MXS40ADCMIC0); <span class="comment">/* Enable the block */</span></div><div class="line">    <a class="code" href="group__group__adcmic__functions__basic.html#gaa5d3e860c0703f4daa932ed6d3e2b416">Cy_ADCMic_StartConvert</a>(MXS40ADCMIC0); <span class="comment">/* Start the conversion */</span></div></div><!-- fragment --><p> Usually the MIC mode is used with FIFO, see <a class="el" href="group__group__adcmic.html#group_adcmic_fifo">FIFO Usage</a></p>
<h2><a class="anchor" id="group_adcmic_dc"></a>
DC Measurement (DC) Mode</h2>
<div class="fragment"><div class="line"><a class="code" href="structcy__stc__adcmic__dc__path__config__t.html">cy_stc_adcmic_dc_path_config_t</a> ADCMicDcPathCfg =</div><div class="line">{</div><div class="line">    .<a class="code" href="structcy__stc__adcmic__dc__path__config__t.html#a5f73fa33c1ea1e1d3e415c9854013dae">range</a> = <a class="code" href="group__group__adcmic__enums.html#gga882caa2feca9421138c98fce182ca354ab2b7ec39510be085a42a2e5a36fb87af">CY_ADCMIC_DC_RANGE_3_6V</a>,</div><div class="line">    .input = <a class="code" href="group__group__adcmic__enums.html#gga152671e552d2117bcc613e7021ce8514ace32eafc41fe302a92105d665853ac08">CY_ADCMIC_BGREF</a>,</div><div class="line">    .tmrLatch = <span class="keyword">true</span></div><div class="line">};</div><div class="line"></div><div class="line"><a class="code" href="structcy__stc__adcmic__timer__trigger__config__t.html">cy_stc_adcmic_timer_trigger_config_t</a> ADCMicDcTmrTrgCfg =</div><div class="line">{</div><div class="line">    .<a class="code" href="structcy__stc__adcmic__timer__trigger__config__t.html#a66eeeef711c5d0554429eb1ebc7f5e16">timerTrigger</a> = <span class="keyword">false</span>,</div><div class="line">    .fifoTrigger = <span class="keyword">false</span>,</div><div class="line">    .period = 64000UL,</div><div class="line">    .input = <a class="code" href="group__group__adcmic__enums.html#gga8a8f51290d7209070ae205e88d01c32eafc8ecc29ccb75e8f996cdec2662362ac">CY_ADCMIC_TIMER_COUNT_INPUT_CLK_SYS</a></div><div class="line">};</div><div class="line"></div><div class="line"><a class="code" href="structcy__stc__adcmic__config__t.html">cy_stc_adcmic_config_t</a> ADCMicDcCfg =</div><div class="line">{</div><div class="line">    .<a class="code" href="structcy__stc__adcmic__config__t.html#a4d3c269ce9081eb9925acd71a687114e">clockDiv</a> = 2U,</div><div class="line">    .source = <a class="code" href="group__group__adcmic__enums.html#ggabdc8870e3b406f6d7aa66e5a92affb62a38fa43ff6cb50910002588af0a70005e">CY_ADCMIC_DC</a>,</div><div class="line">    .sampleRate = <a class="code" href="group__group__adcmic__enums.html#gga60be2d6103fee3f7a1dbb0f7732ecb16ab5bbe1d743e2e70a60227ebf9baa7b03">CY_ADCMIC_480KSPS</a>,</div><div class="line">    .anaConfig = NULL,</div><div class="line">    .digConfig = NULL,</div><div class="line">    .dcConfig = &amp;ADCMicDcPathCfg,</div><div class="line">    .biQuadConfig = NULL,</div><div class="line">    .fifoConfig = NULL,</div><div class="line">    .tmrTrgConfig = &amp;ADCMicDcTmrTrgCfg</div><div class="line">};</div></div><!-- fragment --><div class="fragment"><div class="line">    <span class="comment">/* Scenario: Initialize ADCMic for the DC measurement: */</span></div><div class="line">    uint16_t data = 0U;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__group__adcmic__enums.html#ggaf46b38a86a6fbdfee98d9b37ae44a154a5372a55427aca75e12013c2bb7844157">CY_ADCMIC_SUCCESS</a> != <a class="code" href="group__group__adcmic__functions__basic.html#ga2d6efe6fc6a1d0f8f2164352fbe8a39d">Cy_ADCMic_Init</a>(MXS40ADCMIC0, &amp;ADCMicDcCfg))</div><div class="line">    {</div><div class="line">        <span class="comment">/* Something went wrong, insert error handling here */</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__group__adcmic__enums.html#ggaf46b38a86a6fbdfee98d9b37ae44a154a5372a55427aca75e12013c2bb7844157">CY_ADCMIC_SUCCESS</a> != <a class="code" href="group__group__adcmic__functions__dc.html#ga00925ec56c2405c64d3c1d7983a76c07">Cy_ADCMic_SetDcConvTime</a>(MXS40ADCMIC0, <a class="code" href="group__group__adcmic__enums.html#ggadaa307f717a5371ac1c332d19ad4696ca7705fe4fc1ed3dcad6d9ba9eb554790c">CY_ADCMIC_DC_CONV_TIME_15_US</a>))</div><div class="line">    {</div><div class="line">        <span class="comment">/* Something went wrong, insert error handling here */</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="group__group__adcmic__functions__dc.html#ga7013420a1e09400cf58e91547ab1dff2">Cy_ADCMic_SelectDcChannel</a>(MXS40ADCMIC0, <a class="code" href="group__group__adcmic__enums.html#gga152671e552d2117bcc613e7021ce8514a7882eae286d66378d954d9743ce1146d">CY_ADCMIC_GPIO0</a>);</div><div class="line">    <a class="code" href="group__group__adcmic__functions__basic.html#ga79da38d2baa05887ea3247d530b37b7f">Cy_ADCMic_Enable</a>(MXS40ADCMIC0); <span class="comment">/* Enable the block */</span></div><div class="line">    <a class="code" href="group__group__adcmic__functions__basic.html#gaa5d3e860c0703f4daa932ed6d3e2b416">Cy_ADCMic_StartConvert</a>(MXS40ADCMIC0); <span class="comment">/* Start the conversion */</span></div><div class="line">    <a class="code" href="group__group__adcmic__functions__dc.html#ga0bfff648caad3604684019c82b740e8d">Cy_ADCMic_IsEndConversion</a>(MXS40ADCMIC0, <a class="code" href="group__group__adcmic__enums.html#ggaef8552fb17411ed60788242595742771a4c92d7cf983ec3bfe5e2393059444b21">CY_ADCMIC_WAIT_FOR_RESULT</a>); <span class="comment">/* Wait the conversion is done */</span></div><div class="line">    <a class="code" href="group__group__adcmic__functions__basic.html#gaf606a1c35ddfe279edcac0cc7ae94322">Cy_ADCMic_StopConvert</a>(MXS40ADCMIC0); <span class="comment">/* Stop the conversion */</span></div><div class="line">    data = <a class="code" href="group__group__adcmic__functions__dc.html#gad6e104e180e9e3c8ef195d55eddec82b">Cy_ADCMic_GetDcResult</a>(MXS40ADCMIC0); <span class="comment">/* Get the result */</span></div></div><!-- fragment --> <h2><a class="anchor" id="group_adcmic_biquad"></a>
Biquad filter Initialization</h2>
<p>The biquad filter usually is used to the audio stream equalization (in MIC or PDM modes): </p><div class="fragment"><div class="line"><a class="code" href="structcy__stc__adcmic__biquad__config__t.html">cy_stc_adcmic_biquad_config_t</a> ADCMicBiQuadCfg =</div><div class="line">{</div><div class="line">    .<a class="code" href="structcy__stc__adcmic__biquad__config__t.html#aa963e3dadd68686606ad8a3c65e07959">bq0_num1_coeff</a> = 0x3F27UL,</div><div class="line">    .bq0_num2_coeff = 0x81B2UL,</div><div class="line">    .bq0_num3_coeff = 0x3F27UL,</div><div class="line">    .bq0_den2_coeff = 0x81B5UL,</div><div class="line">    .bq0_den3_coeff = 0x3E51UL,</div><div class="line">    .bq1_num1_coeff = 0x4CCFUL,</div><div class="line">    .bq1_num2_coeff = 0UL,</div><div class="line">    .bq1_num3_coeff = 0UL,</div><div class="line">    .bq1_den2_coeff = 0UL,</div><div class="line">    .bq1_den3_coeff = 0UL,</div><div class="line">    .bq2_num1_coeff = 0x4000UL,</div><div class="line">    .bq2_num2_coeff = 0UL,</div><div class="line">    .bq2_num3_coeff = 0UL,</div><div class="line">    .bq2_den2_coeff = 0UL,</div><div class="line">    .bq2_den3_coeff = 0UL,</div><div class="line">    .bq3_num1_coeff = 0x4000UL,</div><div class="line">    .bq3_num2_coeff = 0UL,</div><div class="line">    .bq3_num3_coeff = 0UL,</div><div class="line">    .bq3_den2_coeff = 0UL,</div><div class="line">    .bq3_den3_coeff = 0UL,</div><div class="line">    .bq4_num1_coeff = 0x4000UL,</div><div class="line">    .bq4_num2_coeff = 0UL,</div><div class="line">    .bq4_num3_coeff = 0UL,</div><div class="line">    .bq4_den2_coeff = 0UL,</div><div class="line">    .bq4_den3_coeff = 0UL,</div><div class="line">};</div></div><!-- fragment --><div class="fragment"><div class="line">    <span class="comment">/* Scenario: Initialize entire ADCMic with biquad filter */</span></div><div class="line">    ADCMicCfg.<a class="code" href="structcy__stc__adcmic__config__t.html#a676cce57e36ac49522822b06b1f1c61e">biQuadConfig</a> = &amp;ADCMicBiQuadCfg;</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__group__adcmic__enums.html#ggaf46b38a86a6fbdfee98d9b37ae44a154a5372a55427aca75e12013c2bb7844157">CY_ADCMIC_SUCCESS</a> != <a class="code" href="group__group__adcmic__functions__basic.html#ga2d6efe6fc6a1d0f8f2164352fbe8a39d">Cy_ADCMic_Init</a>(MXS40ADCMIC0, &amp;ADCMicCfg))</div><div class="line">    {</div><div class="line">        <span class="comment">/* Something went wrong, insert error handling here */</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* or initialize the BiQuad filter separately */</span></div><div class="line">    <a class="code" href="group__group__adcmic__functions__basic.html#ga8a1feaca602d505d6faea844e1450593">Cy_ADCMic_InitBiquad</a>(MXS40ADCMIC0, &amp;ADCMicBiQuadCfg);</div></div><!-- fragment --> <h1><a class="anchor" id="group_adcmic_clock"></a>
Clocks</h1>
<p>The ADCMic requires two input clocks:</p><ul>
<li>clk_sys - recommended frequency is 96MHz, usually is routed from one of the <a class="el" href="group__group__sysclk__clk__hf.html">High-Frequency Clocks</a></li>
<li>clk_hf - recommended frequency is 24MHz, usually is routed from one of the <a class="el" href="group__group__sysclk__clk__hf.html">High-Frequency Clocks</a></li>
</ul>
<p>For more exact information on the ADCMic clock routing, refer to the datasheet for your device.</p>
<p>The internal dividers are configured by <a class="el" href="structcy__stc__adcmic__config__t.html#a4d3c269ce9081eb9925acd71a687114e">cy_stc_adcmic_config_t::clockDiv</a> for general ADC functional and <a class="el" href="structcy__stc__adcmic__audio__digital__path__config__t.html#ac41b425c3e177c3fc3c522792f31e567">cy_stc_adcmic_audio_digital_path_config_t::clockDiv</a> for the PDM data latching.</p>
<h1><a class="anchor" id="group_adcmic_trigger"></a>
Triggering</h1>
<p>The ADCMic subsystem has two output triggers: from the timer and from the FIFO, they could be configured by the <a class="el" href="structcy__stc__adcmic__timer__trigger__config__t.html#a66eeeef711c5d0554429eb1ebc7f5e16">cy_stc_adcmic_timer_trigger_config_t::timerTrigger</a> and <a class="el" href="structcy__stc__adcmic__timer__trigger__config__t.html#afddc46ea6d5b56b1f930da8c07633434">cy_stc_adcmic_timer_trigger_config_t::fifoTrigger</a> fields.</p>
<p>Also, they could be routed to any periphery using <a class="el" href="group__group__trigmux.html">TrigMux (Trigger Multiplexer)</a> driver, e.g. to DW block: </p><div class="fragment"><div class="line">    <span class="comment">/* Scenario: route the ADCMic FIFO trigger to the DW0 block */</span></div><div class="line">    <a class="code" href="group__group__trigmux__functions.html#ga3671fac144b75c3b3eddc5ab46ae96f6">Cy_TrigMux_Connect</a>(TRIG_IN_MUX_4_ADCMIC_DATA_AVAIL, TRIG_OUT_MUX_0_PDMA0_TR_IN0, <span class="keyword">false</span>, TRIGGER_TYPE_LEVEL);</div></div><!-- fragment --> <h1><a class="anchor" id="group_adcmic_timer"></a>
Timer</h1>
<p>The Timer can be used for two purposes:</p><ul>
<li>generate periodic events based on ADCMic clk_sys clock.</li>
<li>count the CIC data update events.</li>
</ul>
<p>The timer period and input signal source are configured by the <a class="el" href="structcy__stc__adcmic__timer__trigger__config__t.html#aa5b95cea91621ea2866a1471ea9b5b64">cy_stc_adcmic_timer_trigger_config_t::period</a> and <a class="el" href="structcy__stc__adcmic__timer__trigger__config__t.html#a4bd64b1e0b3c93b4a432939707a201ed">cy_stc_adcmic_timer_trigger_config_t::input</a> fields correspondingly.</p>
<h1><a class="anchor" id="group_adcmic_interrupt"></a>
Handling Interrupts</h1>
<p>The ADCMic subsystem has two interrupt sources: the timer and the FIFO. The FIFO interrupt can have several reasons, see <a class="el" href="group__group__adcmic__macros__fifo__status.html">FIFO Status Masks</a></p>
<p>The ADCMic interrupt to the NVIC is raised any time the intersection (logic and) of the interrupt flags and the corresponding interrupt masks are non-zero.</p>
<p>Implement an interrupt routine and assign it to the ADCMic interrupt. Use the pre-defined enumeration, adcmic_interrupt_adcmic_IRQn, as the interrupt source for the ADCMic.</p>
<p>The following code snippet demonstrates how to implement a routine to handle the interrupt. The routine gets called when any one of the ADCMic interrupts are triggered. When servicing an interrupt, the user must clear the interrupt so that subsequent interrupts can be handled.</p>
<p>The following code snippet demonstrates how to configure and enable the interrupt. </p><div class="fragment"><div class="line"><span class="comment">/* ISR function to handle ADCMic interrupts. </span></div><div class="line"><span class="comment"> * This same routine gets called when any of the enabled ADCMic interrupt sources are enabled.</span></div><div class="line"><span class="comment"> */</span></div><div class="line">uint16_t data[64];</div><div class="line">uint8_t  dataCount;</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> ADCMic_Isr(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* Read interrupt status register. */</span></div><div class="line">    uint32_t intrStatus = <a class="code" href="group__group__adcmic__functions__interrupt.html#gae9309c0b0b44c696c3de3a79290ec641">Cy_ADCMic_GetInterruptStatusMasked</a>(MXS40ADCMIC0);</div><div class="line"></div><div class="line">    <span class="comment">/* Check what triggered the interrupt. */</span></div><div class="line">    <span class="keywordflow">if</span> (0UL != (<a class="code" href="group__group__adcmic__macros__interrupt.html#ga1a3748aac7c1fb78f2860c7f36d643d6">CY_ADCMIC_INTR_DATA</a> &amp; intrStatus))</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (0U != (<a class="code" href="group__group__adcmic__macros__fifo__status.html#ga6a606709df5107fdd482ccecde1aea94">CY_ADCMIC_FIFO_EMPTY</a> &amp; <a class="code" href="group__group__adcmic__functions__fifo.html#gae4d911c0c8618b2147c6e3deafdbe419">Cy_ADCMic_GetFifoStatus</a>(MXS40ADCMIC0)))</div><div class="line">        {</div><div class="line">            dataCount = <a class="code" href="group__group__adcmic__functions__fifo.html#ga220eefbf87371967992dbbd993c747d6">Cy_ADCMic_ReadFifoAll</a>(MXS40ADCMIC0, data);</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* Check also the DC interrupt status, if enabled. */</span></div><div class="line"></div><div class="line">    <span class="comment">/* Clear the handled interrupt. */</span></div><div class="line">    <a class="code" href="group__group__adcmic__functions__interrupt.html#ga51c3d5c6bdc5fef18119977ded174a28">Cy_ADCMic_ClearInterrupt</a>(MXS40ADCMIC0, intrStatus);</div><div class="line">}</div></div><!-- fragment --><div class="fragment"><div class="line">    <span class="comment">/* Scenario: Configure and enable the ADCMic interrupt. */</span></div><div class="line">    <span class="keyword">const</span> <a class="code" href="structcy__stc__sysint__t.html">cy_stc_sysint_t</a> ADCMic_IRQ_cfg =</div><div class="line">    {</div><div class="line">        .<a class="code" href="structcy__stc__sysint__t.html#a6da08d81da65a7f93d3e4c46a4b8d950">intrSrc</a>      = adcmic_interrupt_adcmic_IRQn, <span class="comment">/* Interrupt source is the ADCMic interrupt */</span></div><div class="line">        .intrPriority = 7UL                           <span class="comment">/* Interrupt priority is 7 */</span></div><div class="line">    };</div><div class="line">    </div><div class="line">    <span class="comment">/* Configure the interrupt with vector at ADCMic_Isr(). */</span></div><div class="line">    (void)<a class="code" href="group__group__sysint__functions.html#gab2ff6820a898e9af3f780000054eea5d">Cy_SysInt_Init</a>(&amp;ADCMic_IRQ_cfg, ADCMic_Isr);</div><div class="line"></div><div class="line">    <span class="comment">/* Enable the interrupt. */</span></div><div class="line">    NVIC_EnableIRQ(ADCMic_IRQ_cfg.<a class="code" href="structcy__stc__sysint__t.html#a6da08d81da65a7f93d3e4c46a4b8d950">intrSrc</a>);</div><div class="line">    </div><div class="line">    <span class="comment">/* Clear possible interrupt erroneously raised during block enabling */</span></div><div class="line">    <a class="code" href="group__group__adcmic__functions__interrupt.html#ga51c3d5c6bdc5fef18119977ded174a28">Cy_ADCMic_ClearInterrupt</a>(MXS40ADCMIC0, <a class="code" href="group__group__adcmic__macros__interrupt.html#gaa22987ec467c499e394cd707c2d69a42">CY_ADCMIC_INTR</a>);</div><div class="line">    <a class="code" href="group__group__adcmic__functions__interrupt.html#ga50aef66098e540a452357c81e0f06687">Cy_ADCMic_EnableInterrupt</a>(MXS40ADCMIC0, <a class="code" href="group__group__adcmic__macros__interrupt.html#ga1a3748aac7c1fb78f2860c7f36d643d6">CY_ADCMIC_INTR_DATA</a>);</div></div><!-- fragment --><p> Alternately, instead of handling the interrupts, the <a class="el" href="group__group__adcmic__functions__dc.html#ga0bfff648caad3604684019c82b740e8d">Cy_ADCMic_IsEndConversion</a> function allows for firmware polling of the end of DC conversion status.</p>
<h1><a class="anchor" id="group_adcmic_dc_result"></a>
Retrieve DC Measurement Results</h1>
<p>Retrieve the ADC result by calling <a class="el" href="group__group__adcmic__functions__dc.html#gad6e104e180e9e3c8ef195d55eddec82b">Cy_ADCMic_GetDcResult</a> with the desired channel. To convert the result to a voltage, pass the ADC result to <a class="el" href="group__group__adcmic__functions__dc.html#ga09a5d2a54e3ba704ff255b3a1f9d0a5b">Cy_ADCMic_CountsTo_Volts</a>, <a class="el" href="group__group__adcmic__functions__dc.html#gad4aef796efc47b5e4ea96851dd5b096c">Cy_ADCMic_CountsTo_mVolts</a>, or <a class="el" href="group__group__adcmic__functions__dc.html#gafa8eb9e2d46cd6f570b4ca4ce5ec758a">Cy_ADCMic_CountsTo_uVolts</a>.</p>
<h1><a class="anchor" id="group_adcmic_fifo"></a>
FIFO Usage</h1>
<p>The ADCMic subsystem in MIC and PDM modes stores the audio data into the FIFO It can be configured using <a class="el" href="structcy__stc__adcmic__fifo__config__t.html">cy_stc_adcmic_fifo_config_t</a>, and served either by ISR: </p><div class="fragment"><div class="line"><span class="comment">/* ISR function to handle ADCMic interrupts. </span></div><div class="line"><span class="comment"> * This same routine gets called when any of the enabled ADCMic interrupt sources are enabled.</span></div><div class="line"><span class="comment"> */</span></div><div class="line">uint16_t data[64];</div><div class="line">uint8_t  dataCount;</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> ADCMic_Isr(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* Read interrupt status register. */</span></div><div class="line">    uint32_t intrStatus = <a class="code" href="group__group__adcmic__functions__interrupt.html#gae9309c0b0b44c696c3de3a79290ec641">Cy_ADCMic_GetInterruptStatusMasked</a>(MXS40ADCMIC0);</div><div class="line"></div><div class="line">    <span class="comment">/* Check what triggered the interrupt. */</span></div><div class="line">    <span class="keywordflow">if</span> (0UL != (<a class="code" href="group__group__adcmic__macros__interrupt.html#ga1a3748aac7c1fb78f2860c7f36d643d6">CY_ADCMIC_INTR_DATA</a> &amp; intrStatus))</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (0U != (<a class="code" href="group__group__adcmic__macros__fifo__status.html#ga6a606709df5107fdd482ccecde1aea94">CY_ADCMIC_FIFO_EMPTY</a> &amp; <a class="code" href="group__group__adcmic__functions__fifo.html#gae4d911c0c8618b2147c6e3deafdbe419">Cy_ADCMic_GetFifoStatus</a>(MXS40ADCMIC0)))</div><div class="line">        {</div><div class="line">            dataCount = <a class="code" href="group__group__adcmic__functions__fifo.html#ga220eefbf87371967992dbbd993c747d6">Cy_ADCMic_ReadFifoAll</a>(MXS40ADCMIC0, data);</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* Check also the DC interrupt status, if enabled. */</span></div><div class="line"></div><div class="line">    <span class="comment">/* Clear the handled interrupt. */</span></div><div class="line">    <a class="code" href="group__group__adcmic__functions__interrupt.html#ga51c3d5c6bdc5fef18119977ded174a28">Cy_ADCMic_ClearInterrupt</a>(MXS40ADCMIC0, intrStatus);</div><div class="line">}</div></div><!-- fragment --><p>Or by DMA: </p><div class="fragment"><div class="line">    <span class="comment">/* Scenario: route the ADCMic FIFO trigger to the DW0 block */</span></div><div class="line">    <a class="code" href="group__group__trigmux__functions.html#ga3671fac144b75c3b3eddc5ab46ae96f6">Cy_TrigMux_Connect</a>(TRIG_IN_MUX_4_ADCMIC_DATA_AVAIL, TRIG_OUT_MUX_0_PDMA0_TR_IN0, <span class="keyword">false</span>, TRIGGER_TYPE_LEVEL);</div></div><!-- fragment --> <h1><a class="anchor" id="group_adcmic_more_information"></a>
More Information</h1>
<p>For more information on the ADCMic ADC subsystem, refer to the datasheet of your device.</p>
<h1><a class="anchor" id="group_adcmic_changelog"></a>
Changelog</h1>
<table class="doxtable">
<tr>
<th>Version</th><th>Changes</th><th>Reason for Change </th></tr>
<tr>
<td>0.1 </td><td>This is a pre-production driver release. The driver is not recommended for production use, unless the functionality is delivered in Cypress-provided applications. </td><td>Pre-production support of the CAT1B Devices  </td></tr>
</table>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
API Reference</h2></td></tr>
<tr class="memitem:group__group__adcmic__macros"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__adcmic__macros.html">Macros</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__adcmic__enums"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__adcmic__enums.html">Enumerated Types</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__adcmic__data__structures"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__adcmic__data__structures.html">Data Structures</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__adcmic__functions"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__adcmic__functions.html">Functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>MTB CAT1 Peripheral driver library</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
